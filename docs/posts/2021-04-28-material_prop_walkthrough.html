<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pushkar G. Ghanekar">
<meta name="dcterms.date" content="2021-04-28">
<meta name="description" content="Sample project covering various steps necessary for developing a model for material property prediction">

<title>Omnis tempus datum - Mateiral informatics sample project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Omnis tempus datum</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pgg1610"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/mepgg"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Mateiral informatics sample project</h1>
                  <div>
        <div class="description">
          Sample project covering various steps necessary for developing a model for material property prediction
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">chemical-science</div>
                <div class="quarto-category">python</div>
                <div class="quarto-category">machine-learning</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Pushkar G. Ghanekar </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 28, 2021</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#loading-and-cleaning-the-data" id="toc-loading-and-cleaning-the-data" class="nav-link active" data-scroll-target="#loading-and-cleaning-the-data">Loading and cleaning the data</a></li>
  <li><a href="#splitting-data" id="toc-splitting-data" class="nav-link" data-scroll-target="#splitting-data">Splitting data</a></li>
  <li><a href="#model-fitting" id="toc-model-fitting" class="nav-link" data-scroll-target="#model-fitting">Model fitting</a>
  <ul class="collapse">
  <li><a href="#featurization" id="toc-featurization" class="nav-link" data-scroll-target="#featurization">Featurization</a>
  <ul class="collapse">
  <li><a href="#sub-sampling" id="toc-sub-sampling" class="nav-link" data-scroll-target="#sub-sampling">Sub-sampling</a></li>
  </ul></li>
  <li><a href="#feature-scaling" id="toc-feature-scaling" class="nav-link" data-scroll-target="#feature-scaling">Feature scaling</a></li>
  <li><a href="#model-fitting-1" id="toc-model-fitting-1" class="nav-link" data-scroll-target="#model-fitting-1">Model fitting</a></li>
  <li><a href="#feature-importance" id="toc-feature-importance" class="nav-link" data-scroll-target="#feature-importance">Feature Importance</a>
  <ul class="collapse">
  <li><a href="#refit-a-new-model-on-small-feature-set" id="toc-refit-a-new-model-on-small-feature-set" class="nav-link" data-scroll-target="#refit-a-new-model-on-small-feature-set">Refit a new model on small feature set</a></li>
  </ul></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation">Cross-validation</a></li>
  <li><a href="#hyperparameter-optimization" id="toc-hyperparameter-optimization" class="nav-link" data-scroll-target="#hyperparameter-optimization">Hyperparameter Optimization</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>A random forest regression model is built to predict the heat capacity (<span class="math inline">\(C_p\)</span>) of solid inorganic materials at different temperatures. The dataset is collected from the <a href="https://doi.org/10.18434/T42S31">NIST JANAF Thermochemical Table</a></p>
<p>This project is adapted from recent publication looking at best practices for setting up mateial informatics task. * <a href="https://doi.org/10.1021/acs.chemmater.0c01907">A. Y. T. Wang et al., “Machine Learning for Materials Scientists: An Introductory Guide toward Best Practices,” Chem. Mater., vol.&nbsp;32, no. 12, pp.&nbsp;4954–4965, 2020</a>.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#----- PLOTTING PARAMS ----# </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> cm</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># High DPI rendering for mac</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config InlineBackend.figure_format <span class="op">=</span> <span class="st">'retina'</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot matplotlib plots with white background: </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config InlineBackend.print_figure_kwargs<span class="op">=</span>{<span class="st">'facecolor'</span> : <span class="st">"w"</span>}</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>plot_params <span class="op">=</span> {</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="st">'font.size'</span> : <span class="dv">15</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="st">'axes.titlesize'</span> : <span class="dv">15</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="st">'axes.labelsize'</span> : <span class="dv">15</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="st">'axes.labelweight'</span> : <span class="st">'bold'</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="st">'xtick.labelsize'</span> : <span class="dv">12</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="st">'ytick.labelsize'</span> : <span class="dv">12</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update(plot_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="loading-and-cleaning-the-data" class="level1">
<h1>Loading and cleaning the data</h1>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>root_dir <span class="op">=</span> os.getcwd()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>csv_file_path <span class="op">=</span> os.path.join(root_dir, <span class="st">'material_cp.csv'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(csv_file_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df.sample(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>FORMULA</th>
      <th>CONDITION: Temperature (K)</th>
      <th>PROPERTY: Heat Capacity (J/mol K)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1207</th>
      <td>F2Hg1</td>
      <td>1000.0</td>
      <td>89.538</td>
    </tr>
    <tr>
      <th>3910</th>
      <td>Na2O2</td>
      <td>400.0</td>
      <td>97.721</td>
    </tr>
    <tr>
      <th>1183</th>
      <td>Fe0.877S1</td>
      <td>298.0</td>
      <td>49.883</td>
    </tr>
    <tr>
      <th>100</th>
      <td>B2Mg1</td>
      <td>298.0</td>
      <td>47.823</td>
    </tr>
    <tr>
      <th>3879</th>
      <td>N5P3</td>
      <td>1000.0</td>
      <td>265.266</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(4583, 3)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.describe().<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>CONDITION: Temperature (K)</th>
      <th>PROPERTY: Heat Capacity (J/mol K)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>4579.00</td>
      <td>4576.00</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1170.92</td>
      <td>107.48</td>
    </tr>
    <tr>
      <th>std</th>
      <td>741.25</td>
      <td>67.02</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-2000.00</td>
      <td>-102.22</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>600.00</td>
      <td>61.31</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1000.00</td>
      <td>89.50</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1600.00</td>
      <td>135.65</td>
    </tr>
    <tr>
      <th>max</th>
      <td>4700.00</td>
      <td>494.97</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Rename columns for better data handling</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>rename_dict <span class="op">=</span> {<span class="st">'FORMULA'</span>:<span class="st">'formula'</span>, <span class="st">'CONDITION: Temperature (K)'</span>:<span class="st">'T'</span>, <span class="st">'PROPERTY: Heat Capacity (J/mol K)'</span>:<span class="st">'Cp'</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.rename(columns<span class="op">=</span>rename_dict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>formula</th>
      <th>T</th>
      <th>Cp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>B2O3</td>
      <td>1400.0</td>
      <td>134.306</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B2O3</td>
      <td>1300.0</td>
      <td>131.294</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B2O3</td>
      <td>1200.0</td>
      <td>128.072</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B2O3</td>
      <td>1100.0</td>
      <td>124.516</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B2O3</td>
      <td>1000.0</td>
      <td>120.625</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4578</th>
      <td>Zr1</td>
      <td>450.0</td>
      <td>26.246</td>
    </tr>
    <tr>
      <th>4579</th>
      <td>Zr1</td>
      <td>400.0</td>
      <td>25.935</td>
    </tr>
    <tr>
      <th>4580</th>
      <td>Zr1</td>
      <td>350.0</td>
      <td>25.606</td>
    </tr>
    <tr>
      <th>4581</th>
      <td>Zr1</td>
      <td>300.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4582</th>
      <td>Zr1</td>
      <td>298.0</td>
      <td>25.202</td>
    </tr>
  </tbody>
</table>
<p>4583 rows × 3 columns</p>
</div>
</div>
</div>
<p>Check for null entries in the dataset</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>columns_has_NaN <span class="op">=</span> df.columns[df.isnull().<span class="bu">any</span>()]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df[columns_has_NaN].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>formula    4
T          4
Cp         7
dtype: int64</code></pre>
</div>
</div>
<p>Show the null entries in the dataframe</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>is_NaN <span class="op">=</span> df.isnull()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>row_has_NaN <span class="op">=</span> is_NaN.<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>df[row_has_NaN]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>formula</th>
      <th>T</th>
      <th>Cp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>22</th>
      <td>Be1I2</td>
      <td>700.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1218</th>
      <td>NaN</td>
      <td>1300.0</td>
      <td>125.353</td>
    </tr>
    <tr>
      <th>1270</th>
      <td>NaN</td>
      <td>400.0</td>
      <td>79.036</td>
    </tr>
    <tr>
      <th>2085</th>
      <td>C1N1Na1</td>
      <td>400.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2107</th>
      <td>Ca1S1</td>
      <td>1900.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3278</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>108.787</td>
    </tr>
    <tr>
      <th>3632</th>
      <td>H2O2Sr1</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3936</th>
      <td>NaN</td>
      <td>2000.0</td>
      <td>183.678</td>
    </tr>
    <tr>
      <th>3948</th>
      <td>Nb2O5</td>
      <td>900.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3951</th>
      <td>Nb2O5</td>
      <td>600.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3974</th>
      <td>Ni1</td>
      <td>NaN</td>
      <td>30.794</td>
    </tr>
    <tr>
      <th>4264</th>
      <td>O3V2</td>
      <td>NaN</td>
      <td>179.655</td>
    </tr>
    <tr>
      <th>4581</th>
      <td>Zr1</td>
      <td>300.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df_remove_NaN <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">'formula'</span>,<span class="st">'Cp'</span>,<span class="st">'T'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df_remove_NaN.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>formula    0
T          0
Cp         0
dtype: int64</code></pre>
</div>
</div>
<p>Remove unrealistic values from the dataset</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df_remove_NaN.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>T</th>
      <th>Cp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>4570.000000</td>
      <td>4570.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1171.366355</td>
      <td>107.469972</td>
    </tr>
    <tr>
      <th>std</th>
      <td>741.422702</td>
      <td>67.033623</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-2000.000000</td>
      <td>-102.215000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>600.000000</td>
      <td>61.301500</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1000.000000</td>
      <td>89.447500</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1600.000000</td>
      <td>135.624250</td>
    </tr>
    <tr>
      <th>max</th>
      <td>4700.000000</td>
      <td>494.967000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>T_filter <span class="op">=</span> (df_remove_NaN[<span class="st">'T'</span>] <span class="op">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>Cp_filter <span class="op">=</span> (df_remove_NaN[<span class="st">'Cp'</span>] <span class="op">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>df_remove_NaN_neg_values <span class="op">=</span> df_remove_NaN.loc[(<span class="op">~</span>T_filter) <span class="op">&amp;</span> (<span class="op">~</span>Cp_filter)]</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_remove_NaN_neg_values.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(4564, 3)</code></pre>
</div>
</div>
</section>
<section id="splitting-data" class="level1">
<h1>Splitting data</h1>
<p>The dataset in this exercise contains different formulae, Cp and T for that entry as a function of T. There are lot of repeated formulae and there is a chance that randomly splitting the dataset in train/val/test would lead to leaks of material entries between 3 sets.</p>
<p>To avoid this the idea is to generate train/val/test such that all material entries belonging a particular type are included in only that set. Eg: B2O3 entries are only in either train/val/test set. To do so let’s first find the unique material entries in the set and sample those without replacement when making the new train/val/test set</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df_remove_NaN_neg_values.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>formula</th>
      <th>T</th>
      <th>Cp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>B2O3</td>
      <td>1400.0</td>
      <td>134.306</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B2O3</td>
      <td>1300.0</td>
      <td>131.294</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B2O3</td>
      <td>1200.0</td>
      <td>128.072</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B2O3</td>
      <td>1100.0</td>
      <td>124.516</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B2O3</td>
      <td>1000.0</td>
      <td>120.625</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4577</th>
      <td>Zr1</td>
      <td>500.0</td>
      <td>26.564</td>
    </tr>
    <tr>
      <th>4578</th>
      <td>Zr1</td>
      <td>450.0</td>
      <td>26.246</td>
    </tr>
    <tr>
      <th>4579</th>
      <td>Zr1</td>
      <td>400.0</td>
      <td>25.935</td>
    </tr>
    <tr>
      <th>4580</th>
      <td>Zr1</td>
      <td>350.0</td>
      <td>25.606</td>
    </tr>
    <tr>
      <th>4582</th>
      <td>Zr1</td>
      <td>298.0</td>
      <td>25.202</td>
    </tr>
  </tbody>
</table>
<p>4564 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick and definitely dirty </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>train_df, test_df <span class="op">=</span> train_test_split(df, test_size<span class="op">=</span><span class="fl">0.4</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are going to be couple of materials which are going to be present in training and test both</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for intersection </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>train_set <span class="op">=</span> <span class="bu">set</span>(train_df[<span class="st">'formula'</span>].unique())</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>test_set <span class="op">=</span> <span class="bu">set</span>(test_df[<span class="st">'formula'</span>].unique())</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for intersection with val and test</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(train_set.intersection(test_set))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>243</code></pre>
</div>
</div>
<p>Start with unique splitting task</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df[<span class="st">'formula'</span>].unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>244</code></pre>
</div>
</div>
<p>Out of 244 unique materials entries, 233 are present in both training and test. This is problematic for model building especially since we’re going to featurize the materials using solely the composition-based features.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>f_entries <span class="op">=</span> df[<span class="st">'formula'</span>].value_counts()[:<span class="dv">50</span>]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">20</span>))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>ax.barh(f_entries.index, f_entries.values)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">90</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-04-28-material_prop_walkthrough_files/figure-html/cell-21-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'formula'</span>].unique()[:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>array(['B2O3', 'Be1I2', 'Be1F3Li1', 'Al1Cl4K1', 'Al2Be1O4', 'B2H4O4',
       'B2Mg1', 'Be1F2', 'B1H4Na1', 'Br2Ca1'], dtype=object)</code></pre>
</div>
</div>
<p>Creating train/val/test manually</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>unique_entries <span class="op">=</span> df[<span class="st">'formula'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set size for train/val/test set </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>train_set <span class="op">=</span> <span class="fl">0.7</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>val_set <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>test_set <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> train_set <span class="op">-</span> val_set </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>num_entries_train <span class="op">=</span> <span class="bu">int</span>( train_set <span class="op">*</span> <span class="bu">len</span>(unique_entries) )</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>num_entries_val <span class="op">=</span> <span class="bu">int</span>( val_set <span class="op">*</span> <span class="bu">len</span>(unique_entries) )</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>num_entries_test <span class="op">=</span> <span class="bu">int</span>( test_set <span class="op">*</span> <span class="bu">len</span>(unique_entries) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(num_entries_train, num_entries_val, num_entries_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>170 48 24</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train formula </span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>train_formulae <span class="op">=</span> np.random.choice(unique_entries, num_entries_train, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>unique_entries_minus_train <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> unique_entries <span class="cf">if</span> i <span class="kw">not</span> <span class="kw">in</span> train_formulae]</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Val formula </span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>val_formulae <span class="op">=</span> np.random.choice(unique_entries_minus_train, num_entries_val, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>unique_entries_minus_train_val <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> unique_entries_minus_train <span class="cf">if</span> i <span class="kw">not</span> <span class="kw">in</span> val_formulae]</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Test formula </span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>test_formulae <span class="op">=</span> unique_entries_minus_train_val.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(train_formulae), <span class="bu">len</span>(val_formulae), <span class="bu">len</span>(test_formulae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>170 48 26</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>train_points <span class="op">=</span> df.loc[ df[<span class="st">'formula'</span>].isin(train_formulae) ]</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>val_points <span class="op">=</span> df.loc[ df[<span class="st">'formula'</span>].isin(val_formulae) ]</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>test_points <span class="op">=</span> df.loc[ df[<span class="st">'formula'</span>].isin(test_formulae) ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(train_points.shape, val_points.shape, test_points.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(3131, 3) (944, 3) (489, 3)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick sanity check of the method </span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>train_set <span class="op">=</span> <span class="bu">set</span>(train_points[<span class="st">'formula'</span>].unique())</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>val_set <span class="op">=</span> <span class="bu">set</span>(val_points[<span class="st">'formula'</span>].unique())</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>test_set <span class="op">=</span> <span class="bu">set</span>(test_points[<span class="st">'formula'</span>].unique())</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for intersection with val and test</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(train_set.intersection(val_set)), <span class="bu">len</span>(train_set.intersection(test_set)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0 0</code></pre>
</div>
</div>
</section>
<section id="model-fitting" class="level1">
<h1>Model fitting</h1>
<section id="featurization" class="level2">
<h2 class="anchored" data-anchor-id="featurization">Featurization</h2>
<p>Composition-based feature vector (CBFV) is used to describe each mateiral entry (eg: Cr<sub>2</sub>O<sub>3</sub>) with set of elemental and composition based numbers.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the package and the generate_features function</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cbfv.composition <span class="im">import</span> generate_features</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>rename_columns <span class="op">=</span> {<span class="st">'Cp'</span>:<span class="st">'target'</span>}</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>train_points[<span class="st">'Type'</span>] <span class="op">=</span> <span class="st">'Train'</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>val_points[<span class="st">'Type'</span>] <span class="op">=</span> <span class="st">'Val'</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>test_points[<span class="st">'Type'</span>] <span class="op">=</span> <span class="st">'Test'</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>total_data <span class="op">=</span> pd.concat([train_points, val_points, test_points], ignore_index<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>total_data <span class="op">=</span> total_data.rename(columns<span class="op">=</span>rename_columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/pghaneka/miniconda3/envs/torch_38/lib/python3.7/site-packages/ipykernel_launcher.py:2: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  
/Users/pghaneka/miniconda3/envs/torch_38/lib/python3.7/site-packages/ipykernel_launcher.py:3: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  This is separate from the ipykernel package so we can avoid doing imports until
/Users/pghaneka/miniconda3/envs/torch_38/lib/python3.7/site-packages/ipykernel_launcher.py:4: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  after removing the cwd from sys.path.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>total_data.sample(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>formula</th>
      <th>T</th>
      <th>target</th>
      <th>Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3833</th>
      <td>I1K1</td>
      <td>1400.0</td>
      <td>74.601</td>
      <td>Val</td>
    </tr>
    <tr>
      <th>4215</th>
      <td>Cr2O3</td>
      <td>298.0</td>
      <td>120.366</td>
      <td>Test</td>
    </tr>
    <tr>
      <th>1290</th>
      <td>I2Mo1</td>
      <td>1000.0</td>
      <td>91.458</td>
      <td>Train</td>
    </tr>
    <tr>
      <th>1578</th>
      <td>I2Zr1</td>
      <td>700.0</td>
      <td>97.445</td>
      <td>Train</td>
    </tr>
    <tr>
      <th>2379</th>
      <td>Na2O5Si2</td>
      <td>1700.0</td>
      <td>292.880</td>
      <td>Train</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>train_df <span class="op">=</span> total_data.loc[ total_data[<span class="st">'Type'</span>] <span class="op">==</span> <span class="st">'Train'</span> ].drop(columns<span class="op">=</span>[<span class="st">'Type'</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>val_df <span class="op">=</span> total_data.loc[ total_data[<span class="st">'Type'</span>] <span class="op">==</span> <span class="st">'Val'</span> ].drop(columns<span class="op">=</span>[<span class="st">'Type'</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> total_data.loc[ total_data[<span class="st">'Type'</span>] <span class="op">==</span> <span class="st">'Test'</span> ].drop(columns<span class="op">=</span>[<span class="st">'Type'</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sub-sampling" class="level3">
<h3 class="anchored" data-anchor-id="sub-sampling">Sub-sampling</h3>
<p>Only some points from the original training data <code>train_df</code> are used to ensure the analysis is tractable</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>train_df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>(3131, 3)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>train_df <span class="op">=</span> train_df.sample(n<span class="op">=</span><span class="dv">1000</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>train_df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>(1000, 3)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate features </span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>X_unscaled_train, y_train, formulae_entry_train, skipped_entry <span class="op">=</span> generate_features(train_df, elem_prop<span class="op">=</span><span class="st">'oliynyk'</span>, drop_duplicates<span class="op">=</span><span class="va">False</span>, extend_features<span class="op">=</span><span class="va">True</span>, sum_feat<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>X_unscaled_val, y_val, formulae_entry_val, skipped_entry <span class="op">=</span> generate_features(val_df, elem_prop<span class="op">=</span><span class="st">'oliynyk'</span>, drop_duplicates<span class="op">=</span><span class="va">False</span>, extend_features<span class="op">=</span><span class="va">True</span>, sum_feat<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>X_unscaled_test, y_test, formulae_entry_test, skipped_entry <span class="op">=</span> generate_features(test_df, elem_prop<span class="op">=</span><span class="st">'oliynyk'</span>, drop_duplicates<span class="op">=</span><span class="va">False</span>, extend_features<span class="op">=</span><span class="va">True</span>, sum_feat<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing Input Data: 100%|██████████| 1000/1000 [00:00&lt;00:00, 26074.09it/s]
Assigning Features...:   0%|          | 0/1000 [00:00&lt;?, ?it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    Featurizing Compositions...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Assigning Features...: 100%|██████████| 1000/1000 [00:00&lt;00:00, 13526.13it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    Creating Pandas Objects...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Processing Input Data: 100%|██████████| 944/944 [00:00&lt;00:00, 28169.72it/s]
Assigning Features...:   0%|          | 0/944 [00:00&lt;?, ?it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    Featurizing Compositions...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Assigning Features...: 100%|██████████| 944/944 [00:00&lt;00:00, 14855.23it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    Creating Pandas Objects...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing Input Data: 100%|██████████| 489/489 [00:00&lt;00:00, 25491.43it/s]
Assigning Features...: 100%|██████████| 489/489 [00:00&lt;00:00, 12626.83it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    Featurizing Compositions...
    Creating Pandas Objects...</code></pre>
</div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>X_unscaled_train.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>sum_Atomic_Number</th>
      <th>sum_Atomic_Weight</th>
      <th>sum_Period</th>
      <th>sum_group</th>
      <th>sum_families</th>
      <th>sum_Metal</th>
      <th>sum_Nonmetal</th>
      <th>sum_Metalliod</th>
      <th>sum_Mendeleev_Number</th>
      <th>sum_l_quantum_number</th>
      <th>...</th>
      <th>range_Melting_point_(K)</th>
      <th>range_Boiling_Point_(K)</th>
      <th>range_Density_(g/mL)</th>
      <th>range_specific_heat_(J/g_K)_</th>
      <th>range_heat_of_fusion_(kJ/mol)_</th>
      <th>range_heat_of_vaporization_(kJ/mol)_</th>
      <th>range_thermal_conductivity_(W/(m_K))_</th>
      <th>range_heat_atomization(kJ/mol)</th>
      <th>range_Cohesive_energy</th>
      <th>T</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>64.0</td>
      <td>139.938350</td>
      <td>10.5</td>
      <td>50.0</td>
      <td>23.25</td>
      <td>1.0</td>
      <td>2.75</td>
      <td>0.0</td>
      <td>289.25</td>
      <td>4.75</td>
      <td>...</td>
      <td>2009873.29</td>
      <td>5.748006e+06</td>
      <td>26.002708</td>
      <td>0.112225</td>
      <td>252.450947</td>
      <td>88384.346755</td>
      <td>4759.155119</td>
      <td>41820.25</td>
      <td>4.410000</td>
      <td>1100.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>58.0</td>
      <td>119.979000</td>
      <td>10.0</td>
      <td>40.0</td>
      <td>18.00</td>
      <td>1.0</td>
      <td>2.00</td>
      <td>0.0</td>
      <td>231.00</td>
      <td>4.00</td>
      <td>...</td>
      <td>505663.21</td>
      <td>1.328602e+06</td>
      <td>8.381025</td>
      <td>0.018225</td>
      <td>36.496702</td>
      <td>28866.010000</td>
      <td>1597.241190</td>
      <td>4830.25</td>
      <td>0.511225</td>
      <td>1100.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>27.0</td>
      <td>58.691000</td>
      <td>6.0</td>
      <td>17.0</td>
      <td>10.00</td>
      <td>1.0</td>
      <td>0.00</td>
      <td>1.0</td>
      <td>115.00</td>
      <td>3.00</td>
      <td>...</td>
      <td>43890.25</td>
      <td>1.277526e+05</td>
      <td>1.210000</td>
      <td>0.062500</td>
      <td>301.890625</td>
      <td>1179.922500</td>
      <td>6.502500</td>
      <td>2652.25</td>
      <td>0.230400</td>
      <td>3400.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>36.0</td>
      <td>72.144000</td>
      <td>7.0</td>
      <td>18.0</td>
      <td>9.00</td>
      <td>1.0</td>
      <td>1.00</td>
      <td>0.0</td>
      <td>95.00</td>
      <td>1.00</td>
      <td>...</td>
      <td>131841.61</td>
      <td>2.700361e+05</td>
      <td>0.067600</td>
      <td>0.001600</td>
      <td>11.636627</td>
      <td>5148.062500</td>
      <td>9973.118090</td>
      <td>2550.25</td>
      <td>0.255025</td>
      <td>2900.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>80.0</td>
      <td>162.954986</td>
      <td>19.0</td>
      <td>120.0</td>
      <td>56.00</td>
      <td>0.0</td>
      <td>8.00</td>
      <td>0.0</td>
      <td>659.00</td>
      <td>8.00</td>
      <td>...</td>
      <td>16129.00</td>
      <td>5.659641e+04</td>
      <td>0.826963</td>
      <td>0.018225</td>
      <td>0.021993</td>
      <td>21.791158</td>
      <td>0.010922</td>
      <td>6241.00</td>
      <td>0.555025</td>
      <td>1300.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 177 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>formulae_entry_train.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>0    Mo1O2.750
1        Fe1S2
2        B1Ti1
3        Ca1S1
4         N5P3
Name: formula, dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>X_unscaled_train.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>(1000, 177)</code></pre>
</div>
</div>
</section>
</section>
<section id="feature-scaling" class="level2">
<h2 class="anchored" data-anchor-id="feature-scaling">Feature scaling</h2>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>X_unscaled_train.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>Index(['sum_Atomic_Number', 'sum_Atomic_Weight', 'sum_Period', 'sum_group',
       'sum_families', 'sum_Metal', 'sum_Nonmetal', 'sum_Metalliod',
       'sum_Mendeleev_Number', 'sum_l_quantum_number',
       ...
       'range_Melting_point_(K)', 'range_Boiling_Point_(K)',
       'range_Density_(g/mL)', 'range_specific_heat_(J/g_K)_',
       'range_heat_of_fusion_(kJ/mol)_',
       'range_heat_of_vaporization_(kJ/mol)_',
       'range_thermal_conductivity_(W/(m_K))_',
       'range_heat_atomization(kJ/mol)', 'range_Cohesive_energy', 'T'],
      dtype='object', length=177)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>X_unscaled_train.describe().<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>sum_Atomic_Number</th>
      <th>sum_Atomic_Weight</th>
      <th>sum_Period</th>
      <th>sum_group</th>
      <th>sum_families</th>
      <th>sum_Metal</th>
      <th>sum_Nonmetal</th>
      <th>sum_Metalliod</th>
      <th>sum_Mendeleev_Number</th>
      <th>sum_l_quantum_number</th>
      <th>...</th>
      <th>range_Melting_point_(K)</th>
      <th>range_Boiling_Point_(K)</th>
      <th>range_Density_(g/mL)</th>
      <th>range_specific_heat_(J/g_K)_</th>
      <th>range_heat_of_fusion_(kJ/mol)_</th>
      <th>range_heat_of_vaporization_(kJ/mol)_</th>
      <th>range_thermal_conductivity_(W/(m_K))_</th>
      <th>range_heat_atomization(kJ/mol)</th>
      <th>range_Cohesive_energy</th>
      <th>T</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>...</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>66.57</td>
      <td>147.21</td>
      <td>11.28</td>
      <td>46.27</td>
      <td>23.19</td>
      <td>1.28</td>
      <td>2.64</td>
      <td>0.08</td>
      <td>292.01</td>
      <td>3.73</td>
      <td>...</td>
      <td>579042.62</td>
      <td>1803422.99</td>
      <td>8.45</td>
      <td>3.34</td>
      <td>181.31</td>
      <td>28201.58</td>
      <td>3305.55</td>
      <td>14959.38</td>
      <td>1.70</td>
      <td>1195.38</td>
    </tr>
    <tr>
      <th>std</th>
      <td>48.94</td>
      <td>116.53</td>
      <td>6.33</td>
      <td>36.29</td>
      <td>16.68</td>
      <td>0.76</td>
      <td>2.32</td>
      <td>0.31</td>
      <td>210.15</td>
      <td>2.59</td>
      <td>...</td>
      <td>750702.41</td>
      <td>2017584.79</td>
      <td>17.52</td>
      <td>10.61</td>
      <td>413.13</td>
      <td>36421.94</td>
      <td>4474.33</td>
      <td>22191.74</td>
      <td>2.45</td>
      <td>760.90</td>
    </tr>
    <tr>
      <th>min</th>
      <td>4.00</td>
      <td>7.95</td>
      <td>2.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>3.00</td>
      <td>0.00</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>31.00</td>
      <td>65.12</td>
      <td>6.00</td>
      <td>18.00</td>
      <td>10.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>126.00</td>
      <td>2.00</td>
      <td>...</td>
      <td>20619.03</td>
      <td>199191.78</td>
      <td>0.23</td>
      <td>0.01</td>
      <td>1.88</td>
      <td>1451.91</td>
      <td>119.61</td>
      <td>729.00</td>
      <td>0.09</td>
      <td>600.00</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>55.00</td>
      <td>118.00</td>
      <td>10.00</td>
      <td>36.00</td>
      <td>20.00</td>
      <td>1.00</td>
      <td>2.00</td>
      <td>0.00</td>
      <td>247.00</td>
      <td>3.00</td>
      <td>...</td>
      <td>222030.88</td>
      <td>1169819.78</td>
      <td>1.25</td>
      <td>0.05</td>
      <td>20.92</td>
      <td>18260.29</td>
      <td>1607.65</td>
      <td>5312.67</td>
      <td>0.63</td>
      <td>1054.00</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>86.00</td>
      <td>182.15</td>
      <td>15.00</td>
      <td>72.00</td>
      <td>36.00</td>
      <td>2.00</td>
      <td>4.00</td>
      <td>0.00</td>
      <td>442.00</td>
      <td>5.00</td>
      <td>...</td>
      <td>882096.64</td>
      <td>3010225.00</td>
      <td>9.33</td>
      <td>0.12</td>
      <td>171.31</td>
      <td>40317.25</td>
      <td>4968.28</td>
      <td>18080.67</td>
      <td>2.08</td>
      <td>1600.00</td>
    </tr>
    <tr>
      <th>max</th>
      <td>278.00</td>
      <td>685.60</td>
      <td>41.00</td>
      <td>256.00</td>
      <td>113.00</td>
      <td>4.00</td>
      <td>15.00</td>
      <td>2.00</td>
      <td>1418.00</td>
      <td>19.00</td>
      <td>...</td>
      <td>3291321.64</td>
      <td>8535162.25</td>
      <td>93.11</td>
      <td>44.12</td>
      <td>2391.45</td>
      <td>168342.03</td>
      <td>40198.47</td>
      <td>95733.56</td>
      <td>10.59</td>
      <td>4600.00</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 177 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>X_unscaled_train[<span class="st">'range_heat_of_vaporization_(kJ/mol)_'</span>].hist()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-04-28-material_prop_walkthrough_files/figure-html/cell-44-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, normalize</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>stdscaler <span class="op">=</span> StandardScaler()</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> stdscaler.fit_transform(X_unscaled_train)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> stdscaler.transform(X_unscaled_val)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> stdscaler.transform(X_unscaled_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(X_train, columns<span class="op">=</span>X_unscaled_train.columns).describe().<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>sum_Atomic_Number</th>
      <th>sum_Atomic_Weight</th>
      <th>sum_Period</th>
      <th>sum_group</th>
      <th>sum_families</th>
      <th>sum_Metal</th>
      <th>sum_Nonmetal</th>
      <th>sum_Metalliod</th>
      <th>sum_Mendeleev_Number</th>
      <th>sum_l_quantum_number</th>
      <th>...</th>
      <th>range_Melting_point_(K)</th>
      <th>range_Boiling_Point_(K)</th>
      <th>range_Density_(g/mL)</th>
      <th>range_specific_heat_(J/g_K)_</th>
      <th>range_heat_of_fusion_(kJ/mol)_</th>
      <th>range_heat_of_vaporization_(kJ/mol)_</th>
      <th>range_thermal_conductivity_(W/(m_K))_</th>
      <th>range_heat_atomization(kJ/mol)</th>
      <th>range_Cohesive_energy</th>
      <th>T</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>...</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>-0.00</td>
      <td>-0.00</td>
      <td>-0.00</td>
      <td>0.00</td>
      <td>-0.00</td>
      <td>-0.00</td>
      <td>-0.00</td>
      <td>-0.00</td>
      <td>-0.00</td>
      <td>-0.00</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>-0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>-0.00</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>...</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-1.28</td>
      <td>-1.20</td>
      <td>-1.47</td>
      <td>-1.25</td>
      <td>-1.33</td>
      <td>-1.68</td>
      <td>-1.14</td>
      <td>-0.27</td>
      <td>-1.38</td>
      <td>-1.44</td>
      <td>...</td>
      <td>-0.77</td>
      <td>-0.89</td>
      <td>-0.48</td>
      <td>-0.31</td>
      <td>-0.44</td>
      <td>-0.77</td>
      <td>-0.74</td>
      <td>-0.67</td>
      <td>-0.69</td>
      <td>-1.57</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-0.73</td>
      <td>-0.70</td>
      <td>-0.83</td>
      <td>-0.78</td>
      <td>-0.79</td>
      <td>-0.36</td>
      <td>-0.71</td>
      <td>-0.27</td>
      <td>-0.79</td>
      <td>-0.67</td>
      <td>...</td>
      <td>-0.74</td>
      <td>-0.80</td>
      <td>-0.47</td>
      <td>-0.31</td>
      <td>-0.43</td>
      <td>-0.73</td>
      <td>-0.71</td>
      <td>-0.64</td>
      <td>-0.66</td>
      <td>-0.78</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>-0.24</td>
      <td>-0.25</td>
      <td>-0.20</td>
      <td>-0.28</td>
      <td>-0.19</td>
      <td>-0.36</td>
      <td>-0.27</td>
      <td>-0.27</td>
      <td>-0.21</td>
      <td>-0.28</td>
      <td>...</td>
      <td>-0.48</td>
      <td>-0.31</td>
      <td>-0.41</td>
      <td>-0.31</td>
      <td>-0.39</td>
      <td>-0.27</td>
      <td>-0.38</td>
      <td>-0.43</td>
      <td>-0.43</td>
      <td>-0.19</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.40</td>
      <td>0.30</td>
      <td>0.59</td>
      <td>0.71</td>
      <td>0.77</td>
      <td>0.96</td>
      <td>0.59</td>
      <td>-0.27</td>
      <td>0.71</td>
      <td>0.49</td>
      <td>...</td>
      <td>0.40</td>
      <td>0.60</td>
      <td>0.05</td>
      <td>-0.30</td>
      <td>-0.02</td>
      <td>0.33</td>
      <td>0.37</td>
      <td>0.14</td>
      <td>0.15</td>
      <td>0.53</td>
    </tr>
    <tr>
      <th>max</th>
      <td>4.32</td>
      <td>4.62</td>
      <td>4.69</td>
      <td>5.78</td>
      <td>5.39</td>
      <td>3.59</td>
      <td>5.34</td>
      <td>6.18</td>
      <td>5.36</td>
      <td>5.89</td>
      <td>...</td>
      <td>3.61</td>
      <td>3.34</td>
      <td>4.83</td>
      <td>3.84</td>
      <td>5.35</td>
      <td>3.85</td>
      <td>8.25</td>
      <td>3.64</td>
      <td>3.62</td>
      <td>4.48</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 177 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(X_train, columns<span class="op">=</span>X_unscaled_train.columns)[<span class="st">'range_heat_of_vaporization_(kJ/mol)_'</span>].hist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2021-04-28-material_prop_walkthrough_files/figure-html/cell-48-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> normalize(X_train)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> normalize(X_val)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> normalize(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(X_train, columns<span class="op">=</span>X_unscaled_train.columns).describe().<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>sum_Atomic_Number</th>
      <th>sum_Atomic_Weight</th>
      <th>sum_Period</th>
      <th>sum_group</th>
      <th>sum_families</th>
      <th>sum_Metal</th>
      <th>sum_Nonmetal</th>
      <th>sum_Metalliod</th>
      <th>sum_Mendeleev_Number</th>
      <th>sum_l_quantum_number</th>
      <th>...</th>
      <th>range_Melting_point_(K)</th>
      <th>range_Boiling_Point_(K)</th>
      <th>range_Density_(g/mL)</th>
      <th>range_specific_heat_(J/g_K)_</th>
      <th>range_heat_of_fusion_(kJ/mol)_</th>
      <th>range_heat_of_vaporization_(kJ/mol)_</th>
      <th>range_thermal_conductivity_(W/(m_K))_</th>
      <th>range_heat_atomization(kJ/mol)</th>
      <th>range_Cohesive_energy</th>
      <th>T</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>...</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>-0.01</td>
      <td>-0.01</td>
      <td>-0.00</td>
      <td>-0.00</td>
      <td>-0.00</td>
      <td>0.00</td>
      <td>-0.00</td>
      <td>-0.01</td>
      <td>-0.00</td>
      <td>0.00</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.01</td>
      <td>-0.00</td>
      <td>-0.01</td>
      <td>-0.00</td>
      <td>0.01</td>
      <td>0.00</td>
      <td>-0.00</td>
      <td>-0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.07</td>
      <td>0.07</td>
      <td>0.07</td>
      <td>0.07</td>
      <td>0.07</td>
      <td>0.08</td>
      <td>0.07</td>
      <td>0.07</td>
      <td>0.07</td>
      <td>0.08</td>
      <td>...</td>
      <td>0.08</td>
      <td>0.08</td>
      <td>0.07</td>
      <td>0.07</td>
      <td>0.07</td>
      <td>0.08</td>
      <td>0.09</td>
      <td>0.08</td>
      <td>0.08</td>
      <td>0.09</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-0.12</td>
      <td>-0.11</td>
      <td>-0.13</td>
      <td>-0.11</td>
      <td>-0.11</td>
      <td>-0.12</td>
      <td>-0.11</td>
      <td>-0.04</td>
      <td>-0.12</td>
      <td>-0.13</td>
      <td>...</td>
      <td>-0.08</td>
      <td>-0.10</td>
      <td>-0.06</td>
      <td>-0.05</td>
      <td>-0.05</td>
      <td>-0.08</td>
      <td>-0.12</td>
      <td>-0.09</td>
      <td>-0.09</td>
      <td>-0.19</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-0.06</td>
      <td>-0.06</td>
      <td>-0.06</td>
      <td>-0.06</td>
      <td>-0.06</td>
      <td>-0.04</td>
      <td>-0.06</td>
      <td>-0.03</td>
      <td>-0.06</td>
      <td>-0.05</td>
      <td>...</td>
      <td>-0.05</td>
      <td>-0.05</td>
      <td>-0.03</td>
      <td>-0.03</td>
      <td>-0.04</td>
      <td>-0.05</td>
      <td>-0.05</td>
      <td>-0.05</td>
      <td>-0.05</td>
      <td>-0.06</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>-0.02</td>
      <td>-0.03</td>
      <td>-0.02</td>
      <td>-0.02</td>
      <td>-0.02</td>
      <td>-0.03</td>
      <td>-0.02</td>
      <td>-0.02</td>
      <td>-0.02</td>
      <td>-0.02</td>
      <td>...</td>
      <td>-0.03</td>
      <td>-0.03</td>
      <td>-0.03</td>
      <td>-0.02</td>
      <td>-0.03</td>
      <td>-0.02</td>
      <td>-0.03</td>
      <td>-0.04</td>
      <td>-0.04</td>
      <td>-0.02</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.03</td>
      <td>0.02</td>
      <td>0.06</td>
      <td>0.06</td>
      <td>0.06</td>
      <td>0.06</td>
      <td>0.05</td>
      <td>-0.02</td>
      <td>0.07</td>
      <td>0.05</td>
      <td>...</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.01</td>
      <td>-0.02</td>
      <td>-0.00</td>
      <td>0.02</td>
      <td>0.03</td>
      <td>0.02</td>
      <td>0.01</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.25</td>
      <td>0.26</td>
      <td>0.19</td>
      <td>0.20</td>
      <td>0.19</td>
      <td>0.25</td>
      <td>0.20</td>
      <td>0.40</td>
      <td>0.19</td>
      <td>0.24</td>
      <td>...</td>
      <td>0.22</td>
      <td>0.23</td>
      <td>0.29</td>
      <td>0.32</td>
      <td>0.43</td>
      <td>0.26</td>
      <td>0.58</td>
      <td>0.26</td>
      <td>0.24</td>
      <td>0.38</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 177 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(X_train, columns<span class="op">=</span>X_unscaled_train.columns)[<span class="st">'range_heat_of_vaporization_(kJ/mol)_'</span>].hist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2021-04-28-material_prop_walkthrough_files/figure-html/cell-51-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="model-fitting-1" class="level2">
<h2 class="anchored" data-anchor-id="model-fitting-1">Model fitting</h2>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> time <span class="im">import</span> time </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score, mean_absolute_error, mean_squared_error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 5.51 s, sys: 31.7 ms, total: 5.54 s
Wall time: 5.57 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>RandomForestRegressor(random_state=42)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> display_performance(y_true, y_pred):</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_true, y_pred)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    mae <span class="op">=</span> mean_absolute_error(y_true, y_pred)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>    rmse <span class="op">=</span> np.sqrt(mean_squared_error(y_true, y_pred))</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'R2: </span><span class="sc">{0:0.2f}</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">'MAE: </span><span class="sc">{1:0.2f}</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">'RMSE: </span><span class="sc">{2:0.2f}</span><span class="st">'</span>.<span class="bu">format</span>(r2, mae, rmse))</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(r2, mae, rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_val)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>display_performance(y_val,y_pred)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R2: 0.81
MAE: 14.03
RMSE: 20.48</code></pre>
</div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">5</span>))</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>ax.scatter(y_val, y_pred, alpha<span class="op">=</span><span class="fl">0.6</span>, label<span class="op">=</span><span class="st">'Random Forest'</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>lims <span class="op">=</span> [np.<span class="bu">min</span>([ax.get_xlim(), ax.get_ylim()]),  <span class="co"># min of both axes</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>        np.<span class="bu">max</span>([ax.get_xlim(), ax.get_ylim()]),  <span class="co"># max of both axes</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear fit</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>reg <span class="op">=</span> np.polyfit(y_val, y_pred, deg<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>ax.plot(lims, reg[<span class="dv">0</span>] <span class="op">*</span> np.array(lims) <span class="op">+</span> reg[<span class="dv">1</span>], <span class="st">'r--'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">'Linear Fit'</span>)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>ax.plot(lims, lims, <span class="st">'k--'</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, zorder<span class="op">=</span><span class="dv">0</span>, label<span class="op">=</span><span class="st">'Parity Line'</span>)</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">'equal'</span>)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'True value'</span>)</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Model predicted'</span>)</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">'best'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>&lt;matplotlib.legend.Legend at 0x7fb9372fb610&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2021-04-28-material_prop_walkthrough_files/figure-html/cell-57-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="feature-importance" class="level2">
<h2 class="anchored" data-anchor-id="feature-importance">Feature Importance</h2>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>feature_name <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> X_unscaled_train.columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(feature_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>177</code></pre>
</div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>X_train.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>(1000, 177)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(model.estimators_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>100</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>mean_feature_importance <span class="op">=</span> model.feature_importances_</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>std_feature_importance <span class="op">=</span> np.std([ tree.feature_importances_ <span class="cf">for</span> tree <span class="kw">in</span> model.estimators_ ], axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>feat_imp_df <span class="op">=</span> pd.DataFrame({<span class="st">'name'</span>:feature_name, <span class="st">'mean_imp'</span>:mean_feature_importance, <span class="st">'std_dev'</span>:std_feature_importance})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>feat_imp_df_top <span class="op">=</span> feat_imp_df.sort_values(<span class="st">'mean_imp'</span>, ascending<span class="op">=</span><span class="va">False</span>)[:<span class="dv">20</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>feat_imp_df_top[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>name</th>
      <th>mean_imp</th>
      <th>std_dev</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>24</th>
      <td>sum_valence_s</td>
      <td>0.383415</td>
      <td>0.273328</td>
    </tr>
    <tr>
      <th>12</th>
      <td>sum_Covalent_Radius</td>
      <td>0.205463</td>
      <td>0.220244</td>
    </tr>
    <tr>
      <th>17</th>
      <td>sum_MB_electonegativity</td>
      <td>0.098704</td>
      <td>0.212963</td>
    </tr>
    <tr>
      <th>31</th>
      <td>sum_Number_of_unfilled_f_valence_electrons</td>
      <td>0.076559</td>
      <td>0.028590</td>
    </tr>
    <tr>
      <th>176</th>
      <td>T</td>
      <td>0.049666</td>
      <td>0.008509</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">30</span>,<span class="dv">3</span>))</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>ax.bar(feat_imp_df_top[<span class="st">'name'</span>], feat_imp_df_top[<span class="st">'mean_imp'</span>], yerr<span class="op">=</span>feat_imp_df_top[<span class="st">'std_dev'</span>])</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Feature Importance'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-04-28-material_prop_walkthrough_files/figure-html/cell-66-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>top_feature_list <span class="op">=</span> feat_imp_df.loc[ feat_imp_df[<span class="st">'mean_imp'</span>] <span class="op">&gt;</span> <span class="fl">0.001</span> ][<span class="st">'name'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(top_feature_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>40</code></pre>
</div>
</div>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>X_train_df <span class="op">=</span> pd.DataFrame(X_train, columns<span class="op">=</span>feature_name)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>X_val_df <span class="op">=</span> pd.DataFrame(X_val, columns<span class="op">=</span>feature_name)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>X_train_short <span class="op">=</span> X_train_df[<span class="bu">list</span>(top_feature_list)]</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>X_val_short <span class="op">=</span> X_val_df[<span class="bu">list</span>(top_feature_list)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_short.shape, X_train.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1000, 40) (1000, 177)</code></pre>
</div>
</div>
<section id="refit-a-new-model-on-small-feature-set" class="level3">
<h3 class="anchored" data-anchor-id="refit-a-new-model-on-small-feature-set">Refit a new model on small feature set</h3>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>model_small <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>model_small.fit(X_train_short, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 1.41 s, sys: 13.9 ms, total: 1.43 s
Wall time: 1.44 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>RandomForestRegressor(random_state=42)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model_small.predict(X_val_short)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>display_performance(y_val, y_pred)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R2: 0.81
MAE: 13.87
RMSE: 20.40</code></pre>
</div>
</div>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">5</span>))</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>ax.scatter(y_val, y_pred, alpha<span class="op">=</span><span class="fl">0.6</span>, label<span class="op">=</span><span class="st">'Random Forest'</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>lims <span class="op">=</span> [np.<span class="bu">min</span>([ax.get_xlim(), ax.get_ylim()]),  <span class="co"># min of both axes</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>        np.<span class="bu">max</span>([ax.get_xlim(), ax.get_ylim()]),  <span class="co"># max of both axes</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear fit</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>reg <span class="op">=</span> np.polyfit(y_val, y_pred, deg<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>ax.plot(lims, reg[<span class="dv">0</span>] <span class="op">*</span> np.array(lims) <span class="op">+</span> reg[<span class="dv">1</span>], <span class="st">'r--'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">'Linear Fit'</span>)</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>ax.plot(lims, lims, <span class="st">'k--'</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, zorder<span class="op">=</span><span class="dv">0</span>, label<span class="op">=</span><span class="st">'Parity Line'</span>)</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">'equal'</span>)</span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'True value'</span>)</span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Model predicted'</span>)</span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">'best'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<pre><code>&lt;matplotlib.legend.Legend at 0x7fb934fa1310&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2021-04-28-material_prop_walkthrough_files/figure-html/cell-74-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation">Cross-validation</h2>
<p>Combine train and validation set to generate one train - test set for cross-validation</p>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train stack </span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>X_y_train <span class="op">=</span> np.c_[X_train_short, y_train]</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>X_y_train.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<pre><code>(1000, 41)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>np.unique(X_y_train[:,<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<pre><code>array([0.])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validation stack</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>X_y_val <span class="op">=</span> np.c_[X_val_short, y_val]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>X_Y_TRAIN <span class="op">=</span> np.vstack((X_y_train, X_y_val))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>X_TRAIN <span class="op">=</span> X_Y_TRAIN[:,<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>].copy()</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>Y_TRAIN <span class="op">=</span> X_Y_TRAIN[:,<span class="op">-</span><span class="dv">1</span>].copy()</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_TRAIN.shape, Y_TRAIN.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1944, 40) (1944,)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_validate</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> display_score(scores, metric):</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>    score_key <span class="op">=</span> <span class="st">'test_</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(metric)</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(metric)</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Mean: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(scores[score_key].mean()))</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Std dev: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(scores[score_key].std()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>_scoring <span class="op">=</span> [<span class="st">'neg_root_mean_squared_error'</span>, <span class="st">'neg_mean_absolute_error'</span>]</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>forest_scores <span class="op">=</span> cross_validate(model, X_TRAIN, Y_TRAIN, </span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>                              scoring <span class="op">=</span> _scoring, cv<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 11.1 s, sys: 66 ms, total: 11.1 s
Wall time: 11.2 s</code></pre>
</div>
</div>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>display_score(forest_scores, _scoring[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>neg_root_mean_squared_error
Mean: -15.22268277329878
Std dev: 3.677396464443359</code></pre>
</div>
</div>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>display_score(forest_scores, _scoring[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>neg_mean_absolute_error
Mean: -9.559763633911203
Std dev: 2.786793874037375</code></pre>
</div>
</div>
</section>
<section id="hyperparameter-optimization" class="level2">
<h2 class="anchored" data-anchor-id="hyperparameter-optimization">Hyperparameter Optimization</h2>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> joblib</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> RandomizedSearchCV</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>random_forest_base_model <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'bootstrap'</span>:[<span class="va">True</span>],</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_samples_leaf'</span>:[<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">200</span>,<span class="dv">500</span>],</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_samples_split'</span>:[<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">200</span>,<span class="dv">500</span>],</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>:[<span class="dv">100</span>,<span class="dv">200</span>,<span class="dv">400</span>,<span class="dv">500</span>],</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_features'</span>:[<span class="st">'auto'</span>,<span class="st">'sqrt'</span>,<span class="st">'log2'</span>],</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>:[<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>]</span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>CV_rf <span class="op">=</span> RandomizedSearchCV(estimator<span class="op">=</span>random_forest_base_model, </span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>                           n_iter<span class="op">=</span><span class="dv">50</span>, </span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>                           param_distributions<span class="op">=</span>param_grid, </span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>                           scoring<span class="op">=</span><span class="st">'neg_root_mean_squared_error'</span>,</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>                           cv <span class="op">=</span> <span class="dv">5</span>, verbose <span class="op">=</span> <span class="dv">1</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>, refit<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> joblib.parallel_backend(<span class="st">'multiprocessing'</span>):</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>    CV_rf.fit(X_TRAIN, Y_TRAIN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting 5 folds for each of 50 candidates, totalling 250 fits
CPU times: user 646 ms, sys: 183 ms, total: 829 ms
Wall time: 1min 5s</code></pre>
</div>
</div>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(CV_rf.best_params_, CV_rf.best_score_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'n_estimators': 100, 'min_samples_split': 10, 'min_samples_leaf': 10, 'max_features': 'auto', 'max_depth': 20, 'bootstrap': True} -19.161578679126375</code></pre>
</div>
</div>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(CV_rf.cv_results_).sort_values(<span class="st">'rank_test_score'</span>)[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="88">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>mean_fit_time</th>
      <th>std_fit_time</th>
      <th>mean_score_time</th>
      <th>std_score_time</th>
      <th>param_n_estimators</th>
      <th>param_min_samples_split</th>
      <th>param_min_samples_leaf</th>
      <th>param_max_features</th>
      <th>param_max_depth</th>
      <th>param_bootstrap</th>
      <th>params</th>
      <th>split0_test_score</th>
      <th>split1_test_score</th>
      <th>split2_test_score</th>
      <th>split3_test_score</th>
      <th>split4_test_score</th>
      <th>mean_test_score</th>
      <th>std_test_score</th>
      <th>rank_test_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>2.390702</td>
      <td>0.061919</td>
      <td>0.014793</td>
      <td>0.000683</td>
      <td>100</td>
      <td>10</td>
      <td>10</td>
      <td>auto</td>
      <td>20</td>
      <td>True</td>
      <td>{'n_estimators': 100, 'min_samples_split': 10,...</td>
      <td>-19.636059</td>
      <td>-20.949326</td>
      <td>-16.321387</td>
      <td>-18.878979</td>
      <td>-20.022143</td>
      <td>-19.161579</td>
      <td>1.568968</td>
      <td>1</td>
    </tr>
    <tr>
      <th>20</th>
      <td>1.299131</td>
      <td>0.010285</td>
      <td>0.033008</td>
      <td>0.003166</td>
      <td>200</td>
      <td>10</td>
      <td>10</td>
      <td>sqrt</td>
      <td>10</td>
      <td>True</td>
      <td>{'n_estimators': 200, 'min_samples_split': 10,...</td>
      <td>-21.980440</td>
      <td>-23.012936</td>
      <td>-18.847124</td>
      <td>-19.781677</td>
      <td>-17.760789</td>
      <td>-20.276593</td>
      <td>1.949783</td>
      <td>2</td>
    </tr>
    <tr>
      <th>22</th>
      <td>10.616245</td>
      <td>0.066480</td>
      <td>0.084979</td>
      <td>0.025942</td>
      <td>500</td>
      <td>5</td>
      <td>10</td>
      <td>auto</td>
      <td>5</td>
      <td>True</td>
      <td>{'n_estimators': 500, 'min_samples_split': 5, ...</td>
      <td>-21.048335</td>
      <td>-23.039862</td>
      <td>-18.059296</td>
      <td>-18.935399</td>
      <td>-20.566808</td>
      <td>-20.329940</td>
      <td>1.733000</td>
      <td>3</td>
    </tr>
    <tr>
      <th>40</th>
      <td>3.364752</td>
      <td>0.126191</td>
      <td>0.089052</td>
      <td>0.004354</td>
      <td>500</td>
      <td>10</td>
      <td>10</td>
      <td>sqrt</td>
      <td>15</td>
      <td>True</td>
      <td>{'n_estimators': 500, 'min_samples_split': 10,...</td>
      <td>-22.245647</td>
      <td>-23.261791</td>
      <td>-18.796893</td>
      <td>-20.179776</td>
      <td>-17.747398</td>
      <td>-20.446301</td>
      <td>2.061082</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.448634</td>
      <td>0.006245</td>
      <td>0.015180</td>
      <td>0.001035</td>
      <td>100</td>
      <td>5</td>
      <td>10</td>
      <td>log2</td>
      <td>20</td>
      <td>True</td>
      <td>{'n_estimators': 100, 'min_samples_split': 5, ...</td>
      <td>-22.658766</td>
      <td>-23.491199</td>
      <td>-19.473837</td>
      <td>-20.457559</td>
      <td>-17.931118</td>
      <td>-20.802496</td>
      <td>2.039804</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> CV_rf.best_estimator_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>best_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>RandomForestRegressor(max_depth=20, min_samples_leaf=10, min_samples_split=10,
                      random_state=42)</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>